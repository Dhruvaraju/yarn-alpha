# yarn-alpha

Yarn dependency management learning log

## What is yarn?

- A package manager
- Yarn provides the below mentioned advantages when compared to other package managers

  - **Offline Caching**: Once installed from npm from next time onwards these will be installed from local.
  - **Deterministic** : packages will be installed in same way if you are using same version of yarn.
  - **Network Performance**: network requests from Yarn are queued to maximize network utilization
  - **Network resilience**: if one request fails, it does not stop the whole install. Previously with NPM, if you couldn't get one package you were trying to install, the whole install would fail
  - **Flat node modules**: This keeps mismatching package versions from creating duplicates in the node modules and hoists packages to the top of the node modules, reducing the size of your total dependencies

  > Yarn and npm has different syntax, example npm install is equal to yarn add

  ### Yarn Features:

  #### Offline mirroring

  - Loads the dependency files to a local folder stored with tar extension which will be used not only for one project but for multiple projects.
  - This increases faster inter team installs and no access to internet after the first time.

  #### Workspaces:

  - Mono repo integration which is a concept originated from facebook. small projects are groups together to form a monorepo. Each project is called as a workspace.
  - Shared dependencies are kept in main directory called as monorepo all other projects can be invoked individually.

#### Auto-merging lock files

- Better version control integration and easy to resolve conflicts
  > yarn supports 2 factor authentication

> Npx is a command which ships with npm used to invoke other functionalities or package binaries like npx grunt.

## Installing yarn

- Yarn requires node js installation
- to install yarn globally `npm install -g yarn` or you can install through an msi
- `yarn -v` to check version of yarn installed.

## Adding and removing packages

- **yarn add** for adding new package
- **yarn remove** for removing a package

### Yarn add example

- Adding new package will create a node_modules folder, package.json, yarn.lock file
- if you do not want git to track node_modules folder add a .gitignore file
- Package.json will contain a json like below, general syntax: `yarn add express`

```
{
  "dependencies": {
    "express": "^4.17.1"
  }
```

- yarn.lock file will have packages, where they are downloaded from and a integrity hash

```
array-flatten@1.1.1:
  version "1.1.1"
  resolved "https://registry.yarnpkg.com/array-flatten/-/array-flatten-1.1.1.tgz#9a5f699051b1e7073328f2a008968b64ea2955d2"
  integrity sha1-ml9pkFGx5wczKPKgCJaLZOopVdI=
```

### Removing package 'yarn remove'

- general syntax for removing packages ` yarn remove express` will remove express.
- After removal the dependencies in package.json will be updated.
- yarn lock file will remove all the dependency references
- node_modules will have only an integrity file.

## What is the significance of package.json

- Every time when we add a new package or remove a package package.json will be updated.
- The corresponding dependencies will be downloaded, in node modules.
- if we remove node modules folder or download a new project from version control we need to set up all the dependencies.
- To do so we can use `yarn install` or `yarn` command as yarn default switch is install.
- To generate a package.json with all default attributes to start a project use `yarn init`
- a package.json generated by **yarn init** will look like below

```
{
  "name": "yarn-pilot-project",
  "version": "1.0.0",
  "description": "pilot project to learn yarn",
  "main": "index.js",
  "author": "dhruva",
  "license": "MIT"
}
```

- Once dependencies are added they will be added in package.json and node_modules will be downloaded.

## Types of Dependencies

### dependencies

These are your normal dependencies, or rather ones that you need when running your code.

### devDependencies

These are your development dependencies. Dependencies that you need at some point in the development workflow but not while running your code (e.g. Babel or Flow).

> To install dependency as a dev dependency use ` yarn install --dev <package-name>`

### peerDependencies

Peer dependencies are a special type of dependency that would only ever come up if you were publishing your own package.

Having a peer dependency means that your package needs a dependency that is the same exact dependency as the person installing your package. This is useful for packages like react that need to have a single copy of react-dom that is also used by the person installing it.

### optionalDependencies

Optional dependencies are just that: optional. If they fail to install, Yarn will still say the install process was successful.

This is useful for dependencies that won’t necessarily work on every machine and you have a fallback plan in case they are not installed (e.g. Watchman).

### bundledDependencies

Array of package names that will be bundled when publishing the package.

Bundled dependencies should be inside your project. The functionality is basically the same as normal dependencies. They will also be packed when running yarn pack.

Normal dependencies are usually installed from the npm registry. Bundled dependencies are useful in cases normal dependencies are not sufficient:

- When you want to re-use a third party library that doesn’t come from the npm registry or that was modified.
- When you want to re-use your own projects as modules.
- When you want to distribute some files with your module.

> To install all dependencies use `yarn install`

> To install only dependencies that are essential to run your app, use `yarn install --production`

#### Sample package.json

```
{
  "name": "my-project",
  "dependencies": {
    "package-a": "^1.0.0"
  },
  "devDependencies": {
    "package-b": "^1.2.1"
  },
  "peerDependencies": {
    "package-c": "^2.5.4"
  },
  "optionalDependencies": {
    "package-d": "^3.1.0"
  }
}
```

## semantic versioning

A way of versioning with three values example as below, Denoting the major minor and patch version.

![semantic versioning](images/semantic-versioning.png)

- a character will placed in front of the version number in semantic versioning. The significance for the character and meaning is explained in the below table.

| Modifier | Usage           | Type                                   | Effective Range     | Description                                                                                                            |
| -------- | --------------- | -------------------------------------- | ------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| none     | ‘4.9.5’         | Exact                                  | 0nly 4.9.5          | Use the exact and only version                                                                                         |
| =        | ‘=4.9.5’        | Exact                                  | Only 4.9.5          | Use the exact and only version                                                                                         |
| ^        | ‘^4.9.5’        | Latest Minor                           | 4.9.5 – 4.999.999   | Latest version greater than or equal to the current minor version, But it should be the current major version.         |
| ~        | ‘~4.9.5’        | Latest patch                           | 4.9.5 – 4.9.999     | Latest version greater than or equal to the current patch version, But the current major and minor should remain same. |
| >        | ‘>4.9.5’        | Greater Than                           | 4.9.6 – 999.999.999 | Any version greater than the current version mentioned                                                                 |
| <        | ‘<4.9.5’        | Less Than                              | 1.0.0 – 4.9.499     | Any version less than the current version mentioned                                                                    |
| >=       | ‘>=4.9.5’       | Greater than or equal to               | 4.9.5 – 999.999.999 | Any version greater than or equal to the current version mentioned.                                                    |
| <=       | ‘<=4.9.5’       | Less than or equal to                  | 1.0.0 – 4.9.5       | Any version less than or equal to the current version mentioned                                                        |
| \*       | ‘\*’            | Latest any                             | 0.0.0 – 999.999.999 | Latest version possible                                                                                                |
| x        | ‘x’             | Latest Any                             | 0.0.0 – 999.999.999 | Latest version possible                                                                                                |
| \*       | ‘4.\*’          | Latest any minor with major 4          | 4.0.0 – 4.999.999   | Any minor and patch version combination but with same major version as mentioned                                       |
| x        | ‘4.x’           | Latest any minor with major 4          | 4.0.0 – 4.999.999   | Any minor and patch version combination but with same major version as mentioned                                       |
| \*       | ‘4.9.\*’        | Latest patch with same minor and major | 4.9.0 – 4.9.999     | Any patch version with the mentioned major and minor version                                                           |
| x        | ‘4.9.x’         | Latest patch with same minor and major | 4.9.0 – 4.9.999     | Any patch version with the mentioned major and minor version                                                           |
| -        | ‘4.9.5 – 9.9.9’ | Between the range specified            | 4.5.9 – 9.9.9       | Any version between the range mentioned including the mentioned versions                                               |

> The same table is available as an image [semantic version cheat sheet](images/semantic-versioning-cheat-sheet.png)